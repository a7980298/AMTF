<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="import :: myimport"></th:block>
<head>
<meta charset="utf-8" />
<link rel="apple-touch-icon" sizes="76x76" th:href="@{/img/apple-icon.png}">
<link rel="icon" type="image/png" th:href="@{/img/favicon.png}">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>管理页面</title>
<meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
<link th:href="@{/css/material-dashboard.css?v=2.1.2}" rel="stylesheet" />
</head>
<style type="text/css">

</style>
<script type="text/javascript">
	var activity_editor;
	$(function(){
		// 注册wangEditor插件
		var E_activity = window.wangEditor;
		activity_editor = new E_activity('#activity_editor');
		activity_editor.customConfig.menus = [
			'head',  // 标题
			'bold' /** 粗体*/, 'fontSize' /** 字号 */, 'fontName' /** 字体 */,'italic' /** 斜体 */,
			'underline',  // 下划线
			'strikeThrough',  // 删除线
			'foreColor',  // 文字颜色
			'backColor',  // 背景颜色
			'link',  // 插入链接
			'list',  // 列表
			'justify',  // 对齐方式
			'quote',  // 引用
			'emoticon',  // 表情   打开后支持表情功能
			'image',  // 插入图片
			'table',  // 表格
			'video',  // 插入视频
			'code',  // 插入代码
			'undo',  // 撤销
			'redo'  // 重复
		]
		//开启debug模式
		activity_editor.customConfig.debug = true;
		// 关闭粘贴内容中的样式
		activity_editor.customConfig.pasteFilterStyle = false
		// 忽略粘贴内容中的图片
		activity_editor.customConfig.pasteIgnoreImg = true
		// 上传路径

		activity_editor.customConfig.uploadFileName = 'myFile'
		activity_editor.customConfig.uploadImgServer = '/amtf/f020005/T002'
		// 进行下文提到的其他配置
		// 将图片大小限制为 3M
		activity_editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024

		//自定义上传图片事件
		activity_editor.customConfig.uploadImgHooks = {
			before: function(xhr, editor, files) {
			},
			success: function(xhr, editor, result) {
				console.log("上传成功");
			},
			//此处失败是服务端返回有数据，但自动设置图片出错，一般是返回数据格式问题
			fail: function(xhr, editor, result) {
				console.log("上传失败,原因是" + result);
			},
			error: function(xhr, editor) {
				console.log("上传出错");
			},
			timeout: function(xhr, editor) {
				console.log("上传超时");
			},
			// 图片上传并返回了结果，想要自己把图片插入到编辑器中
			// 例如服务器端返回的不是 { errno: 0, data: [...] } 这种格式，可使用 customInsert
			customInsert: function(insertImgFn, result) {
				// result 即服务端返回的接口
				console.log('customInsert', result)

				// insertImgFn 可把图片插入到编辑器，传入图片 src ，执行函数即可
				insertImgFn('/amtf/wangeditorimg/' + result.data[0].replace('C:/wangEdito_Img'))
			}
		}
		activity_editor.create();
	});

	$(document).ready(function() {
		md.initDashboardPageCharts();
		md.initVectorMap();
	});
	$(function(){
		$(".dateymd").datetimepicker({
			format : "YYYY/MM/DD",
			icons : {
				time : "fa fa-clock-o",
				date : "fa fa-calendar",
				up : "fa fa-chevron-up",
				down : "fa fa-chevron-down",
				previous : "fa fa-chevron-left",
				next : "fa fa-chevron-right",
				today : "fa fa-screenshot",
				clear : "fa fa-trash",
				close : "fa fa-remove"
			}
		})
	});
	// 活动的check限制
	function amtf_activityCheck(_this) {
		if($(_this).is(':checked') && $(_this).val() == '2'){
			$('#activitycheck1').removeAttr('checked');
			$('#activitycheck2').removeAttr('checked');
		} else {
			$('#activitycheck3').removeAttr('checked');
		}
	}
	// 活动发布
	function amtf_activity() {
		var check;
		if($('#activitycheck3').is(':checked') || $('#activitycheck1').is(':checked') && $('#activitycheck2').is(':checked')){
			check = '0';
		} else {
			if($('#activitycheck1').is(':checked')) {
				check = '0';
			} else if($('#activitycheck2').is(':checked')) {
				check = '1';
			}
		}
		var formData = new FormData($('#amtf_form')[0]);
		formData.set("activity_head", $('#activity_head').val());
		formData.set("activity_position", $('#activity_position').val());
		formData.set("activity_check", check);
		formData.set("activity_sttymd", $('#activity_sttymd').val());
		formData.set("activity_endymd", $('#activity_endymd').val());
		formData.set("activity_editor", activity_editor.txt.html());
		showdiv();
		$.ajax({
			url : CONTEXT_PATH + '/f020005/T001',
			type : 'post',
			dateType : 'html',
			async : true,
			cache: false,
			processData : false, // 用于对data参数进行序列化处理
			contentType : false, // 不要设置Content-Type请求头
			data : formData,
			success : function(result) {
				hidediv();
				if(result.isactivity == '1') {
					setCodeErrList("发布失败，请重试。");
				} else {
					setCodeSuccess("发布成功。。。");
				}
			},
			error : function(res, textStaus) {
				hidediv();
				setCodeErrList("错误！！！请和管理员联系。。。");
			},
		});
	}
</script>
<body class="" onunload="myFunction()">
	<div class="wrapper">
		<th:block th:replace="navbar :: mynavbar"></th:block>
		<div class="main-panel">
			<th:block th:replace="head :: myhead"></th:block>
			<div class="content">
				<!-- 全体通知 -->
				<div class="container-fluid dashboardclass" id="main">
					<i-form class="" th:action="@{/f020005}" method="post" style="height:100%;" id="amtf_form" enctype="multipart/form-data">
					<input type="hidden" name="IViewId" value="f020005"/>
						<div class="col-md-12">
							<div class="card ">
								<div class="card-header card-header-rose card-header-icon">
									<div class="card-icon">
										<i class="material-icons">assignment</i>
									</div>
									<h4 class="card-title">活动举办</h4>
								</div>
								<div class="card-body ">
									<div class="row">
										<label class="col-sm-2 col-form-label">活动主题</label>
										<div class="col-sm-10">
											<div class="form-group">
												<input type="text" class="form-control" name="activity_head" id="activity_head"/>
											</div>
										</div>
									</div>
									<div class="row">
										<label class="col-sm-2 col-form-label">举办地点</label>
										<div class="col-sm-10">
											<div class="form-group">
												<input type="text" class="form-control" name="activity_position" id="activity_position">
											</div>
										</div>
									</div>
									<div class="row">
										<label class="col-sm-2 col-form-label label-checkbox">参与级别</label>
										<div class="col-sm-10 checkbox-radios">
											<div class="form-check form-check-inline">
												<label class="form-check-label">
													<input class="form-check-input" type="checkbox" value="0" onclick="amtf_activityCheck(this)" id="activitycheck1" name="activity_check">
													普通成员
													<span class="form-check-sign">
													<span class="check"></span>
												</span>
												</label>
											</div>
											<div class="form-check form-check-inline">
												<label class="form-check-label">
													<input class="form-check-input" type="checkbox" value="1" onclick="amtf_activityCheck(this)" id="activitycheck2" name="activity_check">
													管理成员
													<span class="form-check-sign">
													<span class="check"></span>
												</span>
												</label>
											</div>
											<div class="form-check form-check-inline">
												<label class="form-check-label">
													<input class="form-check-input" type="checkbox" value="2" onclick="amtf_activityCheck(this)" id="activitycheck3" name="activity_check">
													全体
													<span class="form-check-sign">
													<span class="check"></span>
												</span>
												</label>
											</div>
										</div>
									</div>
									<div class="row">
										<label class="col-sm-2 col-form-label">开始日期</label>
										<div class="col-sm-10">
											<div class="form-group">
												<input type="text" class="form-control dateymd" name="activity_sttymd" id="activity_sttymd">
											</div>
										</div>
									</div>
									<div class="row">
										<label class="col-sm-2 col-form-label">结束日期</label>
										<div class="col-sm-10">
											<div class="form-group">
												<input type="text" class="form-control dateymd" name="activity_endymd" id="activity_endymd">
											</div>
										</div>
									</div>
									<div class="panel-body">
										<div id="activity_editor"></div>
									</div>
									<div class="panel-body text-center">
										<button class="btn btn-primary btn-lg" onclick="amtf_activity()">发布</button>
									</div>
								</div>
							</div>
						</div>
					</i-form>
				</div>
			</div>
		</div>
	</div>
</body>
</html>