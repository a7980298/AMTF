<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="import :: myimport"></th:block>
<head>
<meta charset="utf-8" />
<link rel="apple-touch-icon" sizes="76x76" th:href="@{/img/apple-icon.png}">
<link rel="icon" type="image/png" th:href="@{/img/favicon.png}">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>管理页面</title>
<meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
<link th:href="@{/css/material-dashboard.css?v=2.1.2}" rel="stylesheet" />
</head>
<style type="text/css">

</style>
<script type="text/javascript">
	$(function(){
		//initFileInput("file-file", CONTEXT_PATH + "/f020001/T004");
		// 注册wangEditor插件
		var wangEditor = window.wangEditor;
		var editor = new wangEditor('#editor');
		editor.config.zIndex = 100;
		// 或者 var editor = new E( document.getElementById('editor') )

		document.getElementById('textsumbit').addEventListener('click', function () {
			showdiv();
			$.ajax({
				url: CONTEXT_PATH + '/f020004/T001',
				type: 'post',
				dateType: 'html',
				async: true,
				data: {
					release_head: $('#texthead').val(),
					release_name: editor.txt.html()
				},
				success: function (result) {
					hidediv();
					if(result.updonticey == '1'){
						setCodeSuccess('发布成功！');
					} else {
						setCodeErrList("错误！！！请和管理员联系。。。");
					}
				},
				error: function (res, textStaus) {
					hidediv();
					setCodeErrList("错误！！！请和管理员联系。。。");
				},
			});
		}, false)
		//开启debug模式
		editor.config.debug = true;
		// 关闭粘贴内容中的样式
		editor.config.pasteFilterStyle = false
		// 忽略粘贴内容中的图片
		editor.config.pasteIgnoreImg = true
		// 上传路径
		editor.config.uploadFileName = 'myFile'
		editor.config.uploadImgServer = '/amtf/f020005/T002'
		// 进行下文提到的其他配置
		// 将图片大小限制为 3M
		editor.config.uploadImgMaxSize = 3 * 1024 * 1024
		// 自己写上传图片
		editor.config.customUploadImg = function (resultFiles, insertImgFn) {
			// resultFiles 是 input 中选中的文件列表
			// insertImgFn 是获取图片 url 后，插入到编辑器的方法
			var formData = new FormData($('#amtf_form')[0]);
			formData.append("myFile", resultFiles[0]);
			$.ajax({
				url : CONTEXT_PATH + '/f020004/T002',
				type : 'post',
				dateType : 'html',
				async : true,
				cache: false,
				processData : false, // 用于对data参数进行序列化处理
				contentType : false, // 不要设置Content-Type请求头
				data : formData,
				success : function(result) {
					// 上传图片，返回结果，将图片插入到编辑器中
					insertImgFn('/amtf/wangallnoticesimg/' + result.data[0].replace('C:/wangEdito_AllnoticesImg'));
				},
				error : function(res, textStaus) {
					hidediv();
					setCodeErrList("错误！！！请和管理员联系。。。");
				},
			});
		}
		editor.create();
	});
</script>
<body class="" onunload="myFunction()">
	<div class="wrapper">
		<th:block th:replace="navbar :: mynavbar"></th:block>
		<div class="main-panel">
			<th:block th:replace="head :: myhead"></th:block>
			<div class="content">
				<!-- 全体通知 -->
				<div class="container-fluid dashboardclass" id="main">
					<i-form class="" th:action="@{/f020004}" method="post" style="height:100%;" id="amtf_form" enctype="multipart/form-data">
					<input type="hidden" name="IViewId" value="f020004"/>
						<div class="col-md-12">
							<div class="card">
								<div class="card-header card-header-rose card-header-icon">
									<div class="card-icon">
										<i class="material-icons">assignment</i>
									</div>
									<h4 class="card-title">全体通知</h4>
								</div>
								<div class="row text-center">
									<label class="col-sm-2 col-form-label"></label>
									<div class="col-sm-8">
										<div class="form-group">
											<input type="text" class="form-control text-center" placeholder="标题" id="texthead">
											<span class="bmd-help"></span>
										</div>
									</div>
								</div>
								<div class="panel-body ">
									<div id="editor"></div>
									<div class="col-md-12 ml-auto mr-auto">
										<button type="button" id="textsumbit" class="btn btn-default">发布</button>
									</div>
								</div>
							</div>
						</div>
					</i-form>
				</div>
			</div>
		</div>
	</div>
</body>
</html>